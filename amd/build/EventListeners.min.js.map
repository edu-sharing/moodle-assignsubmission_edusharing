{"version":3,"file":"EventListeners.min.js","sources":["../src/EventListeners.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Tiny edu-sharing Content configuration.\n *\n * @module      assignsubmission_edusharing/EventListeners\n * @copyright   2024 metaVentis GmbH <http://metaventis.com>\n * @license     https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @param       {string} repoUrl\n * @param       {string} ticket\n */\nexport const init = (repoUrl, ticket) => {\n    let isRepoListenerRegistered = false;\n    const applyEventListener = () => {\n        if (isRepoListenerRegistered) {\n            return;\n        }\n        window.addEventListener('message', function handleRepo(event) {\n            if (event.data.event === 'APPLY_NODE') {\n                const node = event.data.data;\n                window.win.close();\n                let filename = node.properties['cm:name'][0];\n                let extension = filename.split('.').pop();\n                if (!extension || extension.length === 0) {\n                    const mimeType = node.mimetype;\n                    const typeMap = {\n                        'image/jpeg': 'jpeg',\n                        'image/png': 'png',\n                        'image/gif': 'gif',\n                        'image/bmp': 'bmp',\n                        'image/tiff': 'tiff',\n                        'image/tif': 'tif',\n                        'image/photoshop': 'psd',\n                        'image/xcf': 'xcf',\n                        'image/pcx': 'pcx',\n                        'video/x-msvideo': 'avi',\n                        'video/mpeg': 'mpg',\n                        'video/x-flash': 'flv',\n                        'video/x-ms-wmv': 'wmv',\n                        'video/mp4': 'mp4',\n                        'video/3gpp': '3gp',\n                        'audio/wav': 'wav',\n                        'audio/mpeg': 'mp3',\n                        'audio/mid': 'mid',\n                        'audio/ogg': 'ogg',\n                        'audio/aiff': 'aif',\n                        'audio/basic': 'au',\n                        'audio/voxware': 'vox',\n                        'audio/x-ms-wma': 'wma',\n                        'audio/x-pn-realaudi': 'ram',\n                        'application/vnd.oasis.opendocument.text': 'odt',\n                        'application/vnd.oasis.opendocument.text-template': 'ott',\n                        'application/vnd.oasis.opendocument.text-web': 'oth',\n                        'application/vnd.oasis.opendocument.text-master': 'odm',\n                        'application/vnd.oasis.opendocument.graphics': 'odg',\n                        'application/vnd.oasis.opendocument.graphics-template': 'otg',\n                        'application/vnd.oasis.opendocument.presentation': 'odp',\n                        'application/vnd.oasis.opendocument.presentation-template': 'otp',\n                        'application/vnd.oasis.opendocument.spreadsheet': 'ods',\n                        'application/vnd.oasis.opendocument.spreadsheet-template': 'ots',\n                        'application/vnd.oasis.opendocument.chart': 'odc',\n                        'application/vnd.oasis.opendocument.formula': 'odf',\n                        'application/vnd.oasis.opendocument.database': 'odb',\n                        'application/vnd.oasis.opendocument.image': 'odi',\n                        'application/vnd.ms-powerpoint': 'ppt',\n                        'application/msword': 'doc',\n                        'application/vnd.ms-word.document.macroEnabled.12': 'docm',\n                        'application/vnd.openxmlformats-officedocument.wordprocessingml.document': 'docx',\n                        'application/vnd.ms-word.template.macroEnabled.12': 'dotm',\n                        'application/vnd.openxmlformats-officedocument.wordprocessingml.template': 'dotx',\n                        'application/vnd.ms-powerpoint.slideshow.macroEnabled.12': 'ppsm',\n                        'application/vnd.openxmlformats-officedocument.presentationml.slideshow': 'ppsx',\n                        'application/vnd.ms-powerpoint.presentation.macroEnabled.12': 'pptm',\n                        'application/vnd.openxmlformats-officedocument.presentationml.presentation': 'pptx',\n                        'application/vnd.ms-excel.sheet.binary.macroEnabled.12': 'xlsb',\n                        'application/vnd.ms-excel.sheet.macroEnabled.12': 'xlsm',\n                        'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet': 'xlsx',\n                        'application/vnd.ms-xpsdocument': 'xps',\n                        'application/vnd.ms-excel': 'xls',\n                        'text/plain': 'txt',\n                        'application/pdf': 'pdf',\n                        'application/zip': 'zip',\n                        'application/epub+zip': 'epub',\n                        'text/xml': 'xml',\n                        'application/vnd.apple.pages': 'pages',\n                        'application/vnd.apple.keynote': 'keynote',\n                        'application/vnd.apple.numbers': 'numbers',\n                    };\n                    if (typeMap[mimeType]) {\n                        filename += '.' + typeMap[mimeType];\n                    }\n                }\n                window.document.getElementById('id_edu_url').value = node.downloadUrl;\n                window.document.getElementById('id_edu_filename').value = filename;\n                window.removeEventListener('message', handleRepo, false);\n            }\n        }, false);\n        isRepoListenerRegistered = true;\n    };\n\n    /**\n     * Function getRepoTargetUrl\n     * @param {Element} element\n     */\n    const getRepoTargetUrl = (element) => {\n        const isSimpleSearchButton = element.id === 'id_searchbutton';\n        if (isSimpleSearchButton) {\n            return repoUrl + '/components/search' + '?reurl=WINDOW&applyDirectories=false&ticket=' + ticket;\n        }\n        const target = element.getAttribute('data-target');\n        let repoTarget;\n        switch (target) {\n            case 'collections':\n                repoTarget = '/components/collections';\n                break;\n            case 'workspace':\n                repoTarget = '/components/workspace/files';\n                break;\n            default:\n                repoTarget = '/components/search';\n        }\n        return repoUrl + repoTarget + '?reurl=WINDOW&applyDirectories=false&ticket=' + ticket;\n    };\n\n    /**\n     * Function onClick\n     * @param {Event}event\n     */\n    const onClick = (event) => {\n        applyEventListener();\n        window.win = window.open(getRepoTargetUrl(event.target));\n    };\n\n    const repoButton = document.getElementById('id_searchbutton');\n    if (repoButton !== null) {\n        repoButton.addEventListener(\"click\", onClick);\n    }\n    const buttonGroupContainer = document.getElementById('eduChooserButtonGroup');\n    if (buttonGroupContainer !== null) {\n        for (const button of buttonGroupContainer.querySelectorAll('button')) {\n            button.addEventListener(\"click\", onClick);\n        }\n    }\n\n    const removeButton = document.getElementById('id_eduRemoveButton');\n    if (removeButton !== null) {\n        const removeCallback = () => {\n            window.document.getElementById('id_edu_filename').value = '';\n            window.document.getElementById('id_edu_url').value = '';\n        };\n        removeButton.addEventListener(\"click\", removeCallback);\n    }\n};\n\n"],"names":["repoUrl","ticket","isRepoListenerRegistered","onClick","event","window","addEventListener","handleRepo","data","node","win","close","filename","properties","extension","split","pop","length","mimeType","mimetype","typeMap","document","getElementById","value","downloadUrl","removeEventListener","open","element","id","repoTarget","getAttribute","getRepoTargetUrl","target","repoButton","buttonGroupContainer","button","querySelectorAll","removeButton","removeCallback"],"mappings":"+KAwBoB,CAACA,QAASC,cACtBC,0BAA2B,QAoHzBC,QAAWC,QAlHTF,2BAGJG,OAAOC,iBAAiB,WAAW,SAASC,WAAWH,UAC1B,eAArBA,MAAMI,KAAKJ,MAAwB,OAC7BK,KAAOL,MAAMI,KAAKA,KACxBH,OAAOK,IAAIC,YACPC,SAAWH,KAAKI,WAAW,WAAW,GACtCC,UAAYF,SAASG,MAAM,KAAKC,UAC/BF,WAAkC,IAArBA,UAAUG,OAAc,OAChCC,SAAWT,KAAKU,SAChBC,QAAU,cACE,mBACD,kBACA,kBACA,mBACC,mBACD,wBACM,kBACN,kBACA,wBACM,mBACL,sBACG,uBACC,kBACL,mBACC,kBACD,mBACC,kBACD,kBACA,mBACC,oBACC,qBACE,uBACC,4BACK,gDACoB,yDACS,oDACL,uDACG,oDACH,6DACS,wDACL,iEACS,uDACV,gEACS,iDACf,mDACE,oDACC,iDACH,sCACX,2BACX,yDAC8B,iFACuB,0DACvB,iFACuB,iEAChB,gFACe,oEACZ,mFACe,+DACpB,wDACP,2EACmB,wCACnC,iCACN,mBACd,wBACK,wBACA,6BACK,kBACZ,oCACmB,wCACE,0CACA,WAEjCA,QAAQF,YACRN,UAAY,IAAMQ,QAAQF,WAGlCb,OAAOgB,SAASC,eAAe,cAAcC,MAAQd,KAAKe,YAC1DnB,OAAOgB,SAASC,eAAe,mBAAmBC,MAAQX,SAC1DP,OAAOoB,oBAAoB,UAAWlB,YAAY,OAEvD,GACHL,0BAA2B,GAiC3BG,OAAOK,IAAML,OAAOqB,KA1BEC,CAAAA,aACsB,oBAAfA,QAAQC,UAE1B5B,QAAAA,iEAAkFC,WAGzF4B,kBADWF,QAAQG,aAAa,oBAG3B,cACDD,WAAa,oCAEZ,YACDA,WAAa,4CAGbA,WAAa,4BAEd7B,QAAU6B,WAAa,+CAAiD5B,QAStD8B,CAAiB3B,MAAM4B,UAG9CC,WAAaZ,SAASC,eAAe,mBACxB,OAAfW,YACAA,WAAW3B,iBAAiB,QAASH,eAEnC+B,qBAAuBb,SAASC,eAAe,4BACxB,OAAzBY,yBACK,MAAMC,UAAUD,qBAAqBE,iBAAiB,UACvDD,OAAO7B,iBAAiB,QAASH,eAInCkC,aAAehB,SAASC,eAAe,yBACxB,OAAjBe,aAAuB,OACjBC,eAAiB,KACnBjC,OAAOgB,SAASC,eAAe,mBAAmBC,MAAQ,GAC1DlB,OAAOgB,SAASC,eAAe,cAAcC,MAAQ,IAEzDc,aAAa/B,iBAAiB,QAASgC"}